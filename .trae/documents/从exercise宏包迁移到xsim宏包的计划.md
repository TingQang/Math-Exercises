# 从exercise宏包迁移到xsim宏包的计划

## 1. 问题分析
- 简单的xsim测试文件可以正常编译
- 但在项目中使用xsim时出现`TeX capacity exceeded`错误，错误信息显示`__xsim_list_title_seq`存在递归定义
- 错误发生在编译`\end{exercise}`时，表明问题与xsim的标题处理机制有关

## 2. 解决方案

### 2.1 增量调试
1. 创建一个最小测试文件，包含项目的所有宏包但仅使用xsim的基本功能
2. 逐步添加项目配置，找出导致冲突的具体因素
3. 测试不同的xsim配置选项，找到避免递归错误的方法

### 2.2 自定义xsim配置
1. 完全避免使用xsim的默认exercise和solution环境
2. 自定义Exercise和Answer类型，使用简单的格式定义
3. 手动处理习题和答案的关联，避免xsim内部的复杂机制
4. 实现基本的超链接功能

### 2.3 测试验证
1. 在test.tex中测试自定义xsim配置
2. 确保超链接功能正常工作
3. 验证篇章结构符合设计文档要求
4. 测试与其他宏包的兼容性

### 2.4 全面迁移
1. 更新config/packages.tex，替换exercise宏包为xsim宏包
2. 更新config/environments.tex，添加自定义xsim配置
3. 更新所有章节文件，替换Exercise环境为自定义Exercise环境
4. 更新所有章节文件，替换Answer环境为自定义Answer环境
5. 测试编译整个项目

## 3. 预期结果
- 成功将项目从exercise宏包迁移到xsim宏包
- 保留原有的习题和答案结构
- 超链接功能正常工作
- 篇章结构符合设计文档要求
- 编译过程无错误

## 4. 风险控制
- 如遇到无法解决的xsim兼容性问题，保留回滚到exercise宏包的选项
- 分阶段迁移，确保每个阶段都能正常编译
- 详细记录配置过程，便于调试和维护