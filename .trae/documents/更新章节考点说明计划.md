# 重新创建章节文件计划（含代码示例）

## 1. 计划目标
- 删除所有现有的章节.tex文件（保留特殊文件）
- 从考点总结.md中提取每章的考点和题型，保存到CSV文件
- 基于CSV文件，按照设计文档的篇章结构，重新创建所有章节文件
- 重点关注题型，使用`\pt{题型}`命令标注
- 考点用黑方形无序列表表示
- 暂时不包含例题

## 2. 实现步骤

### 2.1 步骤1：提取考点和题型到CSV

**代码示例**：`extract_data.py`
```python
import re
import csv

# 章节映射关系
chapter_mapping = {
    '函数、极限、连续': 'ch01',
    '一元函数微分学': 'ch02',
    '一元函数积分学': 'ch03',
    '向量代数和空间解析几何': 'ch04',
    '多元函数微分学': 'ch05',
    '多元函数积分学': 'ch06',
    '无穷级数': 'ch07',
    '行列式': 'ch08',
    '矩阵': 'ch09',
    '向量': 'ch10',
    '线性方程组': 'ch11',
    '矩阵的特征值和特征向量': 'ch12',
    '二次型': 'ch13',
    '随机事件和概率': 'ch14',
    '随机变量及其分布': 'ch15',
    '多维随机变量及其分布': 'ch16',
    '随机变量的数字特征': 'ch17',
    '大数定律和中心极限定理': 'ch18',
    '数理统计的基本概念': 'ch19',
    '参数估计': 'ch20',
    '假设检验': 'ch21'
}

# 读取考点总结文件
with open('数一考点题型总结.md', 'r', encoding='utf-8') as f:
    content = f.read()

# 打开CSV文件写入数据
with open('chapter_data.csv', 'w', newline='', encoding='utf-8') as f:
    writer = csv.writer(f)
    writer.writerow(['chapter_title', 'chapter_file', 'section_title', 'knowledge_point', 'question_type'])
    
    # 提取所有章节
    chapters = re.findall(r'## (.*?)\n', content)
    
    for chapter_title in chapters:
        if chapter_title not in chapter_mapping:
            continue
        
        chapter_file = chapter_mapping[chapter_title]
        
        # 提取章节内容
        chapter_pattern = re.compile(rf'## {re.escape(chapter_title)}.*?(?=## |# |$)', re.DOTALL)
        chapter_content = chapter_pattern.search(content)
        
        if not chapter_content:
            continue
        
        # 提取所有小节
        sections = re.findall(r'### 第\d+节 (.*?)\n', chapter_content.group())
        
        for section_title in sections:
            # 提取小节内容
            section_pattern = re.compile(rf'### 第\d+节 {re.escape(section_title)}.*?(?=### |## |$)', re.DOTALL)
            section_content = section_pattern.search(chapter_content.group())
            
            if not section_content:
                continue
            
            # 提取核心考点
            kd_pattern = re.compile(r'#### 核心考点\n\n(.*?)(?=#### 对应题型|### |## |$)', re.DOTALL)
            kd_match = kd_pattern.search(section_content.group())
            knowledge_points = []
            if kd_match:
                knowledge_points = re.findall(r'- (.*?);?\n', kd_match.group(1))
            
            # 提取对应题型
            qt_pattern = re.compile(r'#### 对应题型\n\n(.*?)(?=#### |### |## |$)', re.DOTALL)
            qt_match = qt_pattern.search(section_content.group())
            question_types = []
            if qt_match:
                question_types = re.findall(r'\d+\. (.*?);?\n', qt_match.group(1))
            
            # 写入CSV
            for kp in knowledge_points:
                writer.writerow([chapter_title, chapter_file, section_title, kp.strip(), ''])
            
            for qt in question_types:
                writer.writerow([chapter_title, chapter_file, section_title, '', qt.strip()])

print("数据提取完成，保存到chapter_data.csv")
```

### 2.2 步骤2：删除现有章节文件

**代码示例**：`delete_old_chapters.py`
```python
import os

content_dir = 'content'

# 遍历content目录
for filename in os.listdir(content_dir):
    if filename.startswith('ch') and filename.endswith('.tex'):
        # 保留特殊文件
        if filename in ['ch00.tex', 'ch99.tex']:
            continue
        # 删除其他章节文件
        file_path = os.path.join(content_dir, filename)
        os.remove(file_path)
        print(f"已删除: {file_path}")

print("所有旧章节文件已删除")
```

### 2.3 步骤3：基于CSV创建新章节文件

**代码示例**：`create_new_chapters.py`
```python
import os
import csv

content_dir = 'content'

# 读取CSV数据
chapter_data = {}
with open('chapter_data.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        chapter_file = row['chapter_file']
        if chapter_file not in chapter_data:
            chapter_data[chapter_file] = {
                'title': row['chapter_title'],
                'sections': {}
            }
        
        section_title = row['section_title']
        if section_title not in chapter_data[chapter_file]['sections']:
            chapter_data[chapter_file]['sections'][section_title] = {
                'knowledge_points': [],
                'question_types': []
            }
        
        # 添加考点
        if row['knowledge_point']:
            chapter_data[chapter_file]['sections'][section_title]['knowledge_points'].append(row['knowledge_point'])
        
        # 添加题型
        if row['question_type']:
            chapter_data[chapter_file]['sections'][section_title]['question_types'].append(row['question_type'])

# 创建新章节文件
for chapter_file, data in chapter_data.items():
    file_path = os.path.join(content_dir, f'{chapter_file}.tex')
    
    with open(file_path, 'w', encoding='utf-8') as f:
        # 写入章节标题
        f.write(f'\\chapter{{{data["title"]}}}\n\n')
        
        # 汇总所有考点到考点说明
        all_knowledge_points = []
        for section in data['sections'].values():
            all_knowledge_points.extend(section['knowledge_points'])
        
        # 去重
        all_knowledge_points = list(set(all_knowledge_points))
        
        # 写入考点说明
        if all_knowledge_points:
            f.write('\\section{考点说明}\n')
            f.write('\\begin{itemize}\n')
            for kp in all_knowledge_points:
                f.write(f'\\item {kp}\n')
            f.write('\\end{itemize}\n\n')
        
        # 写入各小节
        for section_title, section_data in data['sections'].items():
            f.write(f'\\section{{{section_title}}}\n\n')
            
            # 写入题型
            for qt in section_data['question_types']:
                f.write(f'\\pt{{{qt}}}\n\n')

print("所有新章节文件已创建")
```

### 2.4 步骤4：验证创建结果

**验证命令**：
```bash
# 编译文档，验证语法正确性
latexmk -xelatex -output-directory=build main.tex
```

## 3. 技术要点
- 使用正则表达式精确提取Markdown文件中的层级结构和内容
- 使用CSV库管理提取的数据，便于后续处理
- 严格按照设计文档的篇章结构组织LaTeX代码
- 考点说明使用黑方形无序列表，通过styles.tex中的配置实现
- 题型使用`\pt{题型}`命令标注，符合设计文档要求

## 4. 预期结果
- 所有旧的章节文件被删除
- 新的章节文件按照设计文档要求创建
- 每个章节包含正确的"章-节-题型"结构
- 考点说明使用黑方形无序列表
- 题型使用`\pt{题型}`命令标注
- 文档能够成功编译，没有语法错误

## 5. 注意事项
- 保留特殊文件如ch00.tex（前言）和ch99.tex（附录）
- 确保生成的LaTeX代码格式正确，符合编译要求
- 暂时不包含任何例题，只包含考点和题型结构
- 考点和题型数据从考点总结.md中提取，确保准确性